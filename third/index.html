<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Andreja Stajduhar">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>3rd experiment - lab tutorials</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-175887011-1', 'mkdocs.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="..">lab tutorials</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../partone/" class="nav-link">Getting started</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Experiments <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../second/" class="dropdown-item">2nd experiment</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">3rd experiment</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../hosting/" class="nav-link">Hosting/Crediting</a>
                            </li>
                            <li class="navitem">
                                <a href="../advancedtopics/" class="nav-link">Advanced topics</a>
                            </li>
                            <li class="navitem">
                                <a href="../resources/" class="nav-link">Resources</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../second/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../hosting/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#adapting-a-psychopy-experiment-to-jspsych" class="nav-link">Adapting a Psychopy experiment to jsPsych</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="adapting-a-psychopy-experiment-to-jspsych">Adapting a Psychopy experiment to jsPsych</h2>
<p>Let's attempt to adapt an existing Psychopy experiment to jsPsych. For this experiment, we will be showing participants the Ponzo illusion and asking them to judge the length of two bars. The participant will be given the choice of pressing 'f' if the image furthest from them appears smaller or, alternatively, 'k' if the image closest to them appears smaller. The duration of each image is 3000 miliseconds, after which point the trial continues, with or without a participant response. We will also include a break for participants after half of the images have been shown.</p>
<p>If you'd like to try coding the experiment yourself, you will need to download the images, which you can do by cloning the tutorial Github repo <a href="https://github.com/labtutorials/tutorial-website">here</a>.</p>
<p>All of the ways we have attempted to build an eperiment thus far -- a series of single trials pushed to a timeline or a nested timeline containing timeline variables -- can be used to build this experiment. However, an experiment script consisting of individual trials may not be the most efficient way to build this experiment, and nested are designed to be used when we want to loop through <em>different types</em> of trials. Here, what we really want to do is define one type of trial, using one plugin over and over, while our images are swapped out and randomized with each iteration. Let's explore how to do that and, in the process, introduce a different way to push variables to a timeline that may prove useful for more complex experiments down the road. </p>
<p>We will be building this experiment using the new jsPsych hosting service Cognition.run, which doesn't require our experiment script to follow any standard format like we would have to when hosting on Pavlovia (see <a href="../hosting/">Hosting/Crediting</a> for more information). </p>
<p>As always, we will start by defining our timeline followed by our trial variables and finally our trials:</p>
<pre><code>var timeline = [];

// let's define our trial variables

let image_set_one = []; // first set of 5 images
for(let i = 1; i &lt;= 5; i++){
    images.push('Ponzo_' + i + '.png')
}
let image_set_two = []; // second set of 5 images
for(let i = 6; i &lt;= 10; i++){
    images.push('Ponzo_' + i + '.png')
}

// allowed keys
const letter_keys = ['k', 'f'];

//trial duration
let trial_length = 3000

// our randomized image arrays
var my_shuffled_images = jsPsych.randomization.repeat(image_set_one, 1); 
var my_second_shuffled_images = jsPsych.randomization.repeat(image_set_two, 1);

//welcome trial
var welcome = {
    type: 'html-keyboard-response',
    stimulus:'&lt;p&gt;Welcome to the experiment! You will be shown a series of images. If the image further away appears smaller, press &lt;b&gt;f&lt;/b&gt;. If the image closest to you appears smaller, press &lt;b&gt;k&lt;/b&gt;. Do not worry about making the "right" choice, you only have 3 seconds to respond to each image. Press any key on your keyboard to begin.&lt;/p&gt;',
    choices: jsPsych.ALL_KEYS
}
timeline.push(welcome)

//trial 1
    for (let i = 0; i &lt;= my_shuffled_images.length; i++) {
        let trial_1 = [];   
            trial_1 = {
                type: 'image-keyboard-response',
                stimulus: my_shuffled_images[i],
                choices: letter_keys,
                trial_duration: trial_length
            }
            timeline.push(trial_1)
            feedback = {
                type: 'html-keyboard-response',
                stimulus: '&lt;p&gt;Please choose a key.&lt;/p&gt;',
                choices: jsPsych.ALL_KEYS
            }
            if_node = {
                timeline: [feedback],
                conditional_function: function() {
                    let choice = jsPsych.data.get().last(1).values()[0];
                    if(choice.key_press == null){
                        return true;                     
                    } else {
                        return false;
                    }
                }
            }
            if (i === 4){
                break;
            }
            timeline.push(if_node)
        }
</code></pre>
<p>Let's stop for a second to talk about trial one. Here we have defined our first trial, containing our first randomized set of five images. We also want to provide some feedback (trial feedback) to the participant based on some condition, defined in the if_node. The if_node contains a conditional function parameter which, if true, pushes the feedback trial to the timeline and thus to the participant. If the condition evaluates to false, the feedback trial is skipped or hidden from the timeline and thus from the participant as well. Within the conditional function, we have pulled data from the last trial (trial_1) and stored it within the choice variable. We only care about the key press data from the last trial, so within our if statement we have defined the condition we care about (i.e. if no key press data is registered from the last trial, then do...) and defined the code that is to execute after the condition is true. Let's now define our break trial:</p>
<pre><code>// break trial
var break_trial = {
    type: 'html-keyboard-response',
    stimulus: '&lt;p&gt;Great job! Feel free to take a quick break.&lt;/p&gt;'+
              '&lt;p&gt;Press g when you are ready to continue!&lt;/p&gt;',
    choices: ['g']
}
timeline.push(break_trial)

// trial 2 is the same structure as above
</code></pre>
<p>We're done! We have defined our experiment using a combination of both looped and non-looped single trials (i.e. break_trial and image trials). Now all that's left to do is to give the participant a brief message at the end to thank them for their participation and to include the initializaion object, without which our experiment will not work. It is at this point that we can also redirect participants to other sites using the <code>on_finish:</code> parameter. For more information on how to do that, please see <a href="../hosting/">Hosting/Crediting</a>. Let's finish off our experiment now:</p>
<pre><code>// end trial

var end_trial = {
    type: 'html-keyboard-response',
    stimulus: '&lt;p&gt;You have reached the end. Thanks for participating!&lt;/p&gt;'
}
timeline.push(end_trial)

jsPsych.init({
    timeline: timeline
});
</code></pre>
<p>Now all that's left to do is to <a href="https://msyktpdtdi.cognition.run">test run</a> our experiment now to make sure it functions as intended. </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Andreja Stajduhar</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
